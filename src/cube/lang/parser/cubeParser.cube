use cube.lang
use cube.lang.cst
use cube.lang.parser.elements
use cube.lang.tokenizer.symbol
use cube.lang.tokenizer.tokenStream

define cubeParser
  shared
    function parse(text as string) as element = parse(text, new elementTranslator)
    function parseCst(text as string) as cstNode = parse(text, new cstBuilder)

    do
      map.token(NodeType.Identifier)
      map.token(NodeType.Number)
      map.token(NodeType.ConstantKeyword)
      map.operators(Operator.values)
      map.right(Dot, new dotExpressionParser)
      map.right(Equal, new assignParser)
      map.left(LeftParenthesis, new bracketedTermParser)
      map.right(LeftParenthesis, new functionExpressionParser)
      map.left(Keyword.`If`, new ifExpressionParser)
    end
  end

  internal
    shared
      let map = new parserDefinition[_]

      function parse[T](text as string, translator as cstTranslator[T]) as T =
        new parser(map as parserDefinition[T], translator, tokenStream(text))
          .parse
    end
  end
end